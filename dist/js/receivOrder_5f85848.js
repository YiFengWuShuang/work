var _vParams=JSON.parse(decodeURI(getQueryString("param"))),container=$(".contarin"),orderReviseInfoCon=$("#orderReviseInfoCon"),_reg=/^(\s|\S)+(jpg|jpeg|png|gif|bmp|JPG|JPEG|PNG|GIF|BMP)+$/,$scope={},$fileData={},receivOrder=function(){this.init()};receivOrder.prototype={init:function(){this.commonParam=JSON.stringify(commonParam()),this.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',this.start()},orderHead:function(){var e=this,r="";$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"roId":'+_vParams.roId+',"companyId":'+_vParams.companyId+","+e.tokens+',"serviceId":"B03_getReceiveOrderInfo", "commonParam":'+e.commonParam+"}"},success:function(e){if(e=e||{},e.success){if($scope.orderInfo=e.receiveOrder,"receive_err_033"==e.errorCode)return r=e.errorMsg;r+='<h2 class="m-title">基础信息</h2>	<div class="item-wrap">		<ul>			<li><span>供应商：</span>'+$scope.orderInfo.vendorCode+"-"+$scope.orderInfo.vendorAbbr+"</li>			<li><span>收货单号：</span><b>"+$scope.orderInfo.roFormNo+"</b></li>			<li><span>内部单号：</span><b>"+$scope.orderInfo.roInsideNo+"</b></li>			<li><span>收货日期：</span>"+$scope.orderInfo.roFormDate+"</li>			<li><span>收货人：</span>"+$scope.orderInfo.receiveManName+"</li>			<li><span>交易币别：</span>"+$scope.orderInfo.currencyName+"</li>			<li><span>交易税别：</span>"+$scope.orderInfo.taxName+'<label class="checkbox'+(1==$scope.orderInfo.isContainTax?" on":"")+'"><input type="checkbox" checked="checked" disabled>含税'+100*$scope.orderInfo.taxRate+"%</label></li>			<li><span>交易条件：</span>"+$scope.orderInfo.conditionName+"</li>			<li><span>付款条件：</span>"+$scope.orderInfo.payWayName+"</li>		</ul>	</div>",$(".orderInfo").html(r)}else fnTip.hideLoading(),container.show().html('<p style="line-height:2rem; text-align:center">'+e.errorMsg+"</p>")}})},orderBody:function(){function e(e){e.l_file=[],GetAJAXData("POST",{serviceId:"B01_findFileList",docType:15,companyId:$scope.orderInfo.vendorId,searchType:2,id:e.lineId,token:_vParams.token,secretNumber:_vParams.secretNumber,commonParam:commonParam()},function(r){r.success&&r.fileList.forEach(function(r){e.l_file.push({id:r.id,fileName:r.fileName,fileSize:r.fileSize,fileUrl:r.fileUrl,lineNo:r.lineNo})})})}var r=this,o="";$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"roId":'+_vParams.roId+',"companyId":'+_vParams.companyId+","+r.tokens+',"serviceId":"B03_findRoLineList", "commonParam":'+r.commonParam+"}"},success:function(r){if(r=r||{},r.success){$scope.roLineList=r.roLineList,L=$scope.roLineList.length,o+='<h2 class="m-title">收货产品</h2>';for(var i=0;L>i;i++)o+='<div class="item-wrap">	<ul>		<li><span>收货产品：</span>'+$scope.roLineList[i].prodName+" "+$scope.roLineList[i].prodScale+"</li>		<li><span>来源单据：</span><p>采购单："+$scope.roLineList[i].sourcePoNo+"-"+$scope.roLineList[i].sourcePoLineNo+(""==$scope.roLineList[i].sourceDoNo?"":"<br>送货单："+$scope.roLineList[i].sourceDoNo+"-"+$scope.roLineList[i].sourceDoLineNo)+"</p></li>		<li><span>收货批号：</span>"+$scope.roLineList[i].batchNo+"</li>		<li><span>收货数量：</span>"+($scope.roLineList[i].receiveQty||0)+"/"+($scope.roLineList[i].receiveValuationQty||0)+"</li>		<li><span>验退数量：</span>"+($scope.roLineList[i].prQty||0)+"/"+($scope.roLineList[i].prValuationQty||0)+"</li>		<li><span>收货仓库：</span>"+$scope.roLineList[i].invName+"</li>		<li><span>备注：</span><p>"+$scope.roLineList[i].remark+'</p></li>		<li class="files"><span>附件：</span></li>	</ul></div>',e($scope.roLineList[i]);$(".receivOrderOrderDetail").html(o),$scope.roLineList.forEach(function(e,r){var o="<p>";e.l_file.forEach(function(e){o+='<a href="'+e.fileUrl+'"><i class=i-'+(_reg.test(e.fileName)?"image":"word")+"></i>"+e.fileName+"</a>"}),o+="</p>",$(".receivOrderOrderDetail .files").eq(r).html("<span>附件：</span>"+o).show()})}else fnTip.hideLoading(),container.show().html('<p style="line-height:2rem; text-align:center">'+r.errorMsg+"</p>")}})},remark:function(){var e="",r="<p>",o={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B01_findFileList",companyId:$scope.orderInfo.companyId,id:_vParams.roId,commonParam:commonParam(),docType:"15",fileSource:1,searchType:1};GetAJAXData("POST",o,function(e){e.success&&($fileData=e)}),e+='<h2 class="m-title">备注</h2>	<div class="item-wrap">		<ul>			<li><span>备注信息：</span>'+$scope.orderInfo.remark+'</li>			<li class="files"><span>附件：</span></li>		</ul>	</div>',$(".remarks").html(e),$fileData.forEach(function(e){r+='<a href="'+e.fileUrl+'"><i class=i-'+(_reg.test(e.fileName)?"image":"word")+"></i>"+e.fileName+"</a>"}),r+="</p>",$(".remarks .files").html("<span>附件：</span>"+r).show()},start:function(){var e=this;e.orderHead(),e.orderBody(),setTimeout(function(){fnTip.hideLoading()},0),e.remark()}};