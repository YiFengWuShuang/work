var _vParams=JSON.parse(decodeURI(getQueryString("param"))),container=$(".contarin"),orderReviseInfoCon=$("#orderReviseInfoCon"),deliveryOrder=function(){this.init()};deliveryOrder.prototype={init:function(){this.commonParam=JSON.stringify(commonParam()),this.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',this.start()},orderHead:function(){var e=this,a="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"doId":"'+_vParams.doId+'","companyId":"'+_vParams.companyId+'",'+e.tokens+',"serviceId":"B03_getDeliveryOrderInfo", "commonParam":'+e.commonParam+"}"},success:function(r){r=r||{},r.success&&(e.orderInfo=r.deliveryOrder,a+='<div class="m-item">	<div class="item-wrap">		<ul>			<li><span>客户：</span>'+e.orderInfo.customerName+"</li>			<li><span>出货单号：</span><b>"+e.orderInfo.doFormNo+"</b></li>			<li><span>出货日期：</span>"+e.orderInfo.doFormDate+"</li>			<li><span>出货人：</span>"+e.orderInfo.deliveryManName+"</li>			<li><span>预计送达：</span>"+e.orderInfo.planDeliveryDate+'</li>		</ul>	</div></div><div class="m-item deliveryOrderDetail"></div><a href="javascript:;" class="item-wrap item-link">物流单号：'+e.orderInfo.logisticsNo+'<span class="arrow_down"></span></a>')}}),a},orderBody:function(){var e=this,a="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"doId":"'+_vParams.doId+'","companyId":"'+_vParams.companyId+'",'+e.tokens+',"serviceId":"B03_findDoLineList", "commonParam":'+e.commonParam+"}"},success:function(e){if(e=e||{},e.success){var r=e.doLineList,i=r.length;a+='<h2 class="m-title">出货明细</h2>';for(var n=0;i>n;n++)a+='<div class="item-wrap">	<ul>		<li><span>采购单号：</span><b>'+r[n].sourcePoNo+"</b></li>		<li><span>物料编码：</span><b>"+r[n].prodCode+"</b></li>		<li><span>物料详细：</span><p>"+r[n].prodDesc+" "+r[n].prodScale+"</p></li>		<li><span>待出货数量：</span>"+r[n].deliveryQty+r[n].deliveryUnitName+"/"+r[n].deliveryValuationQty+r[n].valuationUnitName+"</li>		<li><span>出货数量：</span>"+r[n].deliveryQty+r[n].deliveryUnitName+"/"+r[n].deliveryValuationQty+r[n].valuationUnitName+"</li>		<li><span>出货批号：</span>"+r[n].batchNo+"</li>		<li><span>出货备注：</span><p>"+r[n].remark+"</p></li>	</ul></div>"}}}),a},start:function(){var e=this;$(".deliveryOrder .showItemCon").html(e.orderHead()),$(".deliveryOrderDetail").html(e.orderBody()),setTimeout(function(){fnTip.hideLoading()},0),4==e.orderInfo.vStatus&&bottomBar(["mobile","share","im"],"","出货"),$body.on("click",".bottom-btn",function(){e.submitFn()})},submitFn:function(){var e=this,a=commonParam();a.secretKey="1",a.joinUpCode="1",$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"deliveryId":"'+_vParams.doId+'","companyId":"'+_vParams.companyId+'",'+e.tokens+',"serviceId":"B03_submitDeliveryOrder","commonParam":'+JSON.stringify(a)+"}"},success:function(e){e=e||{},e.success?fnTip.success(2e3):fnTip.error(2e3)}})}};