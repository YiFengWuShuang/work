var formTip='<div id="formTip" class="formTip"></div>',_vParams=JSON.parse(decodeURI(getQueryString("param"))),OrdersMt=function(){this.init()};OrdersMt.prototype={init:function(){var a=this;a.purchaseUnit=[],a.valuationUnit=[],a.commonParam=JSON.stringify(commonParam()),a.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',a.load=!1,a.memberId="",a.prodId=[],a.start()},orderInfos:function(){var a=this,i="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:"{"+a.tokens+',"serviceId":"B03_findPoAnswerLineList","poAnswerId":"'+_vParams.poAnswerId+'","vendorId":"'+_vParams.vendorId+'","commonParam":'+a.commonParam+" }"},success:function(e){if(e=e||{},e.success){for(var n=e.poLineList,s=0,t=n.length;t>s;s++){var o=n[s],r=o.poSubLineList.length;a.prodId.push(o.prodId),i+='<div class="m-item">	<h2 class="m-title">基本信息</h2>	<div class="item-wrap" data-prod-index="'+s+'">		<ul>			<li><span>物料编码：</span>'+o.prodCode+"</li>			<li><span>物料详细：</span><p>"+o.prodName+" "+o.prodScale+"</p></li>			<li><section><span>数量：</span>"+o.purchaseQty+o.purchaseUnitName+"/"+o.valuationQty+o.valuationUnitName+"</section><section><span>交期：</span>"+o.expectedDelivery+"</section></li>";for(var c=0;r>c;c++){var d=o.poSubLineList[c];i+='<li class="response"><section><span>数量：</span>'+d.purchaseQty+d.purchaseUnit+"/"+d.valuationQty+d.valuationUnit+"</section><section><span>交期：</span>"+d.expectedDelivery+"</section></li>",a.purchaseUnit.push(d.purchaseUnit),a.valuationUnit.push(d.valuationUnit)}i+='			<li><span class="price">单价：</span>&yen; '+o.taxPrice+".00/"+o.valuationUnitName+"</li>			<li><span>备注：</span><p>"+o.remark+'</p></li>		</ul>	</div></div><div class="m-item">	<h2 class="m-title">销售订单信息维护</h2>	<div class="item-wrap">		<section class="clearfix">			<span class="c-label"><b>我方编码：</b></span>			<div class="wfItem">'+o.vProdCode+"				<p>"+o.vProdName+" "+o.vProdScale+'</p>			</div>			<div class="itemEdit">				<input type="text" class="int-search" placeholder="请输入我方编码" />				<div class="btns"><a class="btn-cancel">取消</a><a class="btn-save">确定</a></div>			</div>		</section>';for(var p=0;r>p;p++){var l=o.poSubLineList[p];i+='<section class="m-select clearfix">	<span class="c-label"><b>数量：</b></span>	<div class="c-cont">		<div class="c-cont-item">			<span>'+l.purchaseQty+'</span>			<div id="purchaseQty_'+p+'" class="select3-input"></div>		</div>		<div class="c-cont-item">			<span>'+l.valuationQty+'</span>			<div id="valuationQty_'+p+'" class="select3-input"></div>		</div>	</div></section>'}i+='<span class="edit"></span></div></div>'}a.load=!0,setTimeout(function(){fnTip.hideLoading()},0)}}}),i},units:function(){var a=this,i=[],e=[];$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"serviceId":"B01_findProdUnitListByProd","companyId":"'+_vParams.companyId+'","prodId":"'+a.prodId[0]+'",'+a.tokens+',"commonParam":'+a.commonParam+"}"},success:function(a){if(a=a||{},a.success)for(var n=a.prodUnitList,s=0,t=n.length;t>s;s++)i.push(n[s].prodUnitName),e.push(n[s].basicUnitName)}});for(var n=$(".m-select").length,s=0;n>s;s++)a.initSelect3("#purchaseQty_"+s,i,a.purchaseUnit[s]),a.initSelect3("#valuationQty_"+s,e,a.valuationUnit[s])},start:function(){var a=this;$("#orderInfoCon").html(a.orderInfos()),a.load&&a.units(),a.editProdCode(),a.hideTip(),bottomBar(["share"],a.memberId),$body.on("click",".bottom-btn",function(){a.submitFn()})},initSelect3:function(a,i,e){$(a).select3({allowClear:!0,items:i,placeholder:"请选择",showSearchInputInDropdown:!1,value:e})},editProdCode:function(){function a(a){var i=a.parents(".item-wrap");i.find(".wfItem").show(),i.find(".itemEdit").hide(),i.find(".edit").show(),$("#formTip").remove()}var i=this;$(".contarin").on("click",".edit",function(){var a=$(this),i=a.parent(".item-wrap");a.hide(),i.find(".wfItem").hide(),i.find(".itemEdit").show(),$body.append(formTip)}).on("click",".btn-save",function(){var e=$(this),n=e.parents(".itemEdit").find(".int-search").val();$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"serviceId": "B01_getProdInfoByCode","companyId":"'+_vParams.companyId+'","vendorId":"'+_vParams.vendorId+'","prodCode":"'+n+'","commonParam":'+i.commonParam+","+i.tokens+"}"},success:function(i){if(i=i||{},i.success){var s=i.prodInfo;n==s.prodCode?(e.parents(".item-wrap").find(".wfItem").html(s.prodCode+"<p>"+s.prodName+" "+s.prodScale+"</p>"),a(e)):$("#formTip").html("产品编码错误，请重新输入").addClass("formTipShow")}}})}).on("click",".btn-cancel",function(){var i=$(this);a(i)})},hideTip:function(){$body.on("focus",'input[type="text"]',function(){$("#formTip").removeClass("formTipShow")})},submitFn:function(){var a=$("#taxType").select3("value"),i=[];i[0]={taxName:a},$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"poAnswerOrderInfo":'+JSON.stringify(i)+',"serviceId":"B03_poAnswerToSalesOrder"}'},success:function(){fnTip.success(2e3),setTimeout(function(){goBack()},2e3)}})}};