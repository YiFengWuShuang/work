var $formTip=$("#formTip"),Reg=function(){this.clickNum=0,this.countdown=60,this.init()};Reg.prototype={init:function(){var i=this;$("form input.required").blur(function(){i.validateFn($(this))}),$("form .btnBig").on("click",function(){var t=$(this);if(!t.hasClass("btnBig-g")){var e=t.parent("form").find("input.required");i.validateFn(e);var o=$(".formTipShow").length;if(o)return!1;if(t.is("#btn-getCode")){if(!$("#clauseChecked").prop("checked"))return $formTip.html("您未勾选《用户使用协议》").addClass("formTipShow"),!1;var r=$("#phone").val(),a=getQueryString("inviteCode");if(fnTip.loading(),i.checkAccount(r))return;i.settime(t,"免费获取验证码"),$.ajax({type:"POST",dataType:"json",async:!1,url:"http://172.31.10.168/usersystem/login/getSmsVerifyCode/v1",data:JSON.stringify({mobile:r}),success:function(i){return fnTip.hideLoading(),i=i||{},"01250"!=i.retCode?(console.log(i.retMsg),!1):void t.attr("href","http://172.31.10.164/dist/html/invitationReg2.html?&mobile="+r+"&inviteCode="+a)}})}if(t.is("#btn-next")){var r=getQueryString("mobile"),n=$("#validateCode").val().trim(),a=getQueryString("inviteCode");fnTip.loading(),i.clickNum++,i.clickNum>3&&i.settime(t,"下一步"),$.ajax({type:"POST",dataType:"json",async:!1,url:"http://172.31.10.168/usersystem/recover_password/checkSmsVerifyCode/v1",data:JSON.stringify({mobile:r,smsVerifyCode:n}),success:function(e){return fnTip.hideLoading(),e=e||{},"0"!=e.errorCode?"01443"==e.errorCode?($formTip.html("手机验证码不正确").addClass("formTipShow"),!1):(console.log(e.errorMsg),!1):(i.clickNum=0,void t.attr("href","http://172.31.10.164/dist/html/invitationReg3.html?&mobile="+r+"&inviteCode="+a))}})}if(t.is("#btn-end")){var r=getQueryString("mobile"),a=getQueryString("inviteCode"),s=$("#psw-1").val(),l=$("#psw-2").val();s=faultylabs.MD5(faultylabs.MD5(s)),l=faultylabs.MD5(faultylabs.MD5(l)),fnTip.loading(),i.clickNum++,i.clickNum>3&&i.settime(t,"完成"),$.ajax({type:"POST",dataType:"json",async:!1,url:"http://172.31.10.168/usersystem/register/registerAccountOnMobile/v1",data:JSON.stringify({mobile:r,invitationCode:a,password:s,confirmPassWd:l,dataSource:dataSource()}),success:function(e){return fnTip.hideLoading(),e=e||{},"0"!=e.errorCode?"02145"==e.errorCode?($formTip.html("输入密码不一致").addClass("formTipShow"),!1):(console.log(e.errorMsg),!1):(i.clickNum=0,void t.attr("href","http://172.31.10.164/dist/html/join.html?&companyName="+e.companyName))}})}t.is("#btn-login"),t.is("#btn-reg")}})},validateFn:function(i){i.each(function(){var i=$(this);if(i.is("#phone")){if(""==i.val()||""!=i.val()&&!/^[1][3578][0-9]{9}$/.test(i.val())){var t="手机号码格式不正确";return $formTip.html(t).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}if(i.is("#validateCode")){var e=i.val();if(""==e){var t="手机验证码不能为空";return $formTip.html(t).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}if(i.is("#psw-1")){if(""==i.val()||""!=i.val()&&!/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/.test(i.val())){var t="密码不能为空或格式不正确";return $formTip.html(t).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}if(i.is("#psw-2")){var o=$("#psw-1").val();if(""==i.val()||i.val()!=o){var t="输入密码不一致";return $formTip.html(t).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}})},checkAccount:function(i){var t=!0;return $.ajax({type:"POST",dataType:"json",async:!1,url:"http://172.31.10.168/usersystem/register/checkAccount/v1",data:JSON.stringify({account:i}),success:function(i){fnTip.hideLoading(),i=i||{},"01110"==i.retCode?t=!1:"01111"==i.retCode?($formTip.html("用户名已注册").addClass("formTipShow"),t=!0):($formTip.html("操作失败").addClass("formTipShow"),t=!0)}}),t},settime:function(i,t){var e=this;0==e.countdown?(i.removeClass("btnBig-g"),i.html(t),e.countdown=60):(i.addClass("btnBig-g"),i.html("重新操作("+e.countdown+")"),e.countdown--,setTimeout(function(){e.settime(i,t)},1e3))}};