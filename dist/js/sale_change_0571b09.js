var formTip='<div id="formTip" class="formTip"></div>',$itemTips=$(".item-tips"),container=$(".contarin"),orderReviseInfoCon=$("#orderReviseInfoCon"),$currencySymbol="",$priceDecimalNum="",$amountDecimalNum="",Lists=function(){this.init()};Lists.prototype={init:function(){var e=this;e._files=[],e._lineLists=[],e._othersCost=[],e.load=!1,setTimeout(function(){container.show(),fnTip.hideLoading()},0),requestFn("B03_POCType",function(a){"0"==a.errorCode&&(e.changeType=a.dataSet.data.detail)}),requestFn("B03_POCReasonType",function(a){"0"==a.errorCode&&(e.reasonType=a.dataSet.data.detail)}),requestFn("B02_LogisticsType",function(a){"0"==a.errorCode&&(e.logisticsType=a.dataSet.data.detail)}),requestFn("B02_InvoiceType",function(a){"0"==a.errorCode&&(e.invoiceType=a.dataSet.data.detail)}),requestFn("B02_Invoice",function(a){"0"==a.errorCode&&(e.invoiceInfoName=a.dataSet.data.detail)}),e.start(),$(".item-total").html("变更前总金额："+$currencySymbol+formatMoney(e.orderInfo.poTotalAmount,$amountDecimalNum)).show(),$(".item-total-dj").html("变更后总金额："+$currencySymbol+formatMoney(e.orderInfo.totalAmount,$amountDecimalNum)).show()},orderBaseInfo:function(){var e=this,a="",n={serviceId:"B03_getSocNoticeInfo",companyId:_vParams.companyId,id:_vParams.id,commonParam:commonParam(),token:_vParams.token,secretNumber:_vParams.secretNumber};return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:"param="+JSON.stringify(n),success:function(n){n=n||{},n.success&&(e.orderInfo=n.socChange,$currencySymbol=e.orderInfo.currencySymbol,$priceDecimalNum=e.orderInfo.priceDecimalNum,$amountDecimalNum=e.orderInfo.amountDecimalNum,a+='<h2 class="m-title">变更信息</h2><div class="item-wrap">	<ul>		<li><span>内部销售单号：</span><b>'+e.orderInfo.soInsideNo+"</b></li>		<li><span>内部变更单号：</span><b>"+e.orderInfo.socFormNo+"</b></li>		<li><span>客户简称：</span>"+e.orderInfo.companyAbbr+"</li>		<li><span>变更类型：</span>"+enumFn(e.changeType,e.orderInfo.changeType)+"</li>		<li><span>变更日期：</span>"+e.orderInfo.socFormDate+"</li>		<li><span>变更原因：</span>"+enumFn(e.reasonType,e.orderInfo.changeReason)+"</li>		<li><span>变更备注：</span>"+e.orderInfo.remark+"</li>	</ul></div>")}}),a},prodBodyInfo:function(){var e=this,a="",n={serviceId:"B03_findSocNoticeLineList",companyId:_vParams.companyId,id:_vParams.id,commonParam:commonParam(),token:_vParams.token,secretNumber:_vParams.secretNumber};return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:"param="+JSON.stringify(n),success:function(n){if(n=n||{},n.success){var o=n.socChangeLine;e._lineLists=o,a='<h2 class="m-title">销售明细</h2>';for(var i=0,t=o.length;t>i;i++){var s=!0;o[i].saleUnitName==o[i].valuationUnitName&&(s=!1),a+='<div class="item-wrap" data-index="'+i+'">	<ul>		<li class="prodCode"><span>物料编码：</span><b>'+o[i].prodCode+"</b></li>		<li><span>物料详细：</span><p>"+o[i].prodName+" "+o[i].prodScale+"</p></li>		<li><section><span>数量：</span><em>"+o[i].salesQty+"</em>"+o[i].saleUnitName+(s?"/<em>"+o[i].valuationQty+"</em>"+o[i].valuationUnitName:"")+"</section><section><span>交期：</span><em>"+o[i].expectedDelivery+'</em></section></li>		<li><section class="'+(o[i].changeQty!=o[i].salesQty||o[i].changeValuationQty!=o[i].valuationQty?"red":"")+'"><span>变更后：</span><em>'+o[i].changeQty+"</em>"+o[i].saleUnitName+(s?"/<em>"+o[i].changeValuationQty+"</em>"+o[i].valuationUnitName:"")+'</section><section class="'+(o[i].changeExpectedDelivery!=o[i].expectedDelivery?"red":"")+'"><span>交期：</span><em>'+o[i].changeExpectedDelivery+'</em></section></li>		<li class="price"><span>单价：</span>'+$currencySymbol+(1==e.orderInfo.isContainTax?formatMoney(o[i].taxPrice,$priceDecimalNum):formatMoney(o[i].price,$priceDecimalNum))+"/"+o[i].valuationUnitName+"</li>		<li><span>备注：</span><p>"+o[i].remark+'</p></li>		<li class="files"><span>附件：</span></li>		<li class=""><span>含税小计：</span><b>'+$currencySymbol+formatMoney(o[i].taxLineTotal,$amountDecimalNum)+"</b></li>"+(""!=o[i].changeTaxLineTotal?'<li class="'+(o[i].changeTaxLineTotal!=o[i].taxLineTotal?"red":"")+'" data-changeTotal="'+o[i].changeTaxLineTotal+'"><span>变更小计：</span><b>'+$currencySymbol+formatMoney(o[i].changeTaxLineTotal,$amountDecimalNum)+"</b></li>":"")+"	</ul></div>"}e.load=!0}else container.show().html('<p style="text-align:center;">'+n.errorMsg+"</p>"),fnTip.hideLoading()}}),a},othersCost:function(){var e=this,a="";if(e.load){var n={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B03_findSocNoticeOtherCostList",companyId:_vParams.companyId,socId:_vParams.id,commonParam:commonParam()};$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:"param="+JSON.stringify(n),success:function(n){if(n=n||{},n.success){var o=n.costList;e._othersCost=o,a='<h2 class="m-title">其他费用</h2><div class="item-wrap" data-index="0"><ul>';for(var i=0,t=o.length;t>i;i++)a+="<li><span>"+o[i].costName+"：</span><b>"+$currencySymbol+formatMoney(o[i].costAmount,$amountDecimalNum)+'</b><b class=""><em class="money">'+formatMoney(o[i].changeCostAmount,$amountDecimalNum)+"</em></b></li>";a+='<li id="othersCostSubtotal"><span>小计：</span><b>'+$currencySymbol+formatMoney(e.orderInfo.poOtherCostTotal,$amountDecimalNum)+'</b></li><li id="changeCost" class="'+(e.orderInfo.poOtherCostTotal!=e.orderInfo.otherCostTotal?"red":"")+'"><span>变更费用：</span><b>'+$currencySymbol+formatMoney(e.orderInfo.otherCostTotal,$amountDecimalNum)+"<b></li></ul></div>",$("#othersCost").html(a)}}})}},initSelect3:function(e,a,n){$(e).select3({allowClear:!0,items:a,placeholder:"请选择",showSearchInputInDropdown:!1,value:n})},start:function(){var e=this,a=document.getElementById("orderHeadInfo"),n=document.getElementById("prodBodyInfo");a.innerHTML=e.orderBaseInfo(),n.innerHTML=e.prodBodyInfo(),e.othersCost(),bottomBar(["share"],e.orderInfo.socManPid,!0),container.on("click","a.item-link",function(){var a=$(this),n=a.attr("name"),o=$body.scrollTop();switch(n){case"payInfo":orderReviseInfoCon.html(e.payInfo(o));break;case"remark":orderReviseInfoCon.html(e.remark(o))}$body.scrollTop(0),container.addClass("contarinEdit"),$("#jBottom").addClass("m-bottom-hide")}).on("click",".btn-wrap .btnB",function(){var e=$(this),a=e.attr("data-scrollTop");container.removeClass("contarinEdit"),$("#jBottom").removeClass("m-bottom-hide"),setTimeout(function(){$body.scrollTop(a)},200)})},payInfo:function(e){var a=this,n=a.orderInfo,o='<ul class="payInfoList"><li><span>交易条件：</span><p>'+n.conditionName+"</p></li><li><span>物流方式：</span><p>"+enumFn(a.logisticsType,n.logisticsType)+(3!=n.logisticsType?"（物流商："+n.logisticsName+"）":"")+"</p></li><li><span>"+(3==n.logisticsType?"自提点":"收货地址")+"：</span><p>"+n.provinceName+n.cityName+n.districtName+n.address+"<br>收货人："+n.contactPerson+"，电话："+n.mobile+"</p></li><li><span>付款条件：</span><p>"+n.payWayName+"</p></li>";return o+=1==n.invoice?"<li><span>发票信息：</span><p>"+enumFn(a.invoiceInfoName,n.invoice)+"</p></li>":"<li><span>发票类型：</span><p>"+enumFn(a.invoiceType,n.invoiceType)+"</p></li><li><span>发票抬头：</span><p>"+n.invoiceHeader+"</p></li><li><span>发票类容：</span><p>"+n.invoiceContent+"</p></li>",o+='</ul><div class="btn-wrap"><a href="javascript:;" class="btnB" data-scrollTop="'+e+'">返回</a></div>'},remark:function(e){var a=this,n='<div class="remarks-wrap"><div id="provisions" class="item-wrap clause">	<h2>补充条款：</h2>	<p>'+a.orderInfo.agreement+'</p></div><div id="taRemarks" class="item-wrap taRemarks">	<h2>备注信息：</h2>	<p>'+a.orderInfo.remark+'</p></div><div id="files" class="item-wrap attachment">	<h2>订单附件：</h2>';return n+='</div></div></div><div class="btn-wrap"><a href="javascript:;" id="saveRemark" class="btnB" data-scrollTop="'+e+'">返回</a></div>'}};