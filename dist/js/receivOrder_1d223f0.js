var _vParams=JSON.parse(decodeURI(getQueryString("param"))),container=$(".contarin"),_reg=/^(\s|\S)+(jpg|jpeg|png|gif|bmp|JPG|JPEG|PNG|GIF|BMP)+$/,$scope={},$fileData={},receivOrder=function(){this.init()};receivOrder.prototype={init:function(){this.commonParam=JSON.stringify(commonParam()),this.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',this.start()},orderHead:function(){var e=this,i="";$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"roId":'+_vParams.roId+',"companyId":'+_vParams.companyId+","+e.tokens+',"serviceId":"B03_getReceiveOrderInfo", "commonParam":'+e.commonParam+"}"},success:function(e){if(e=e||{},e.success){if($scope.orderInfo=e.receiveOrder,"receive_err_033"==e.errorCode)return i=e.errorMsg;i+='<h2 class="m-title">基础信息</h2>	<div class="item-wrap">		<ul>			<li><span>供应商：</span>'+$scope.orderInfo.vendorCode+"-"+$scope.orderInfo.vendorAbbr+"</li>			<li><span>收货单号：</span><b>"+$scope.orderInfo.roFormNo+"</b></li>			<li><span>内部单号：</span><b>"+$scope.orderInfo.roInsideNo+"</b></li>			<li><span>收货日期：</span>"+$scope.orderInfo.roFormDate+"</li>			<li><span>收货人：</span>"+$scope.orderInfo.receiveManName+"</li>			<li><span>交易币别：</span>"+$scope.orderInfo.currencyName+"</li>			<li><span>交易税别：</span>"+$scope.orderInfo.taxName+'<label class="checkbox'+(1==$scope.orderInfo.isContainTax?" on":"")+'"><input type="checkbox" checked="checked" disabled>含税'+100*$scope.orderInfo.taxRate+"%</label></li>			<li><span>交易条件：</span>"+$scope.orderInfo.conditionName+"</li>			<li><span>付款条件：</span>"+$scope.orderInfo.payWayName+"</li>		</ul>	</div>",$(".orderInfo").html(i)}else fnTip.hideLoading(),container.show().html('<p style="line-height:2rem; text-align:center">'+e.errorMsg+"</p>")}})},orderBody:function(){function e(e){e.l_file=[],GetAJAXData("POST",{serviceId:"B01_findFileList",docType:15,companyId:_vParams.companyId,searchType:2,id:e.lineId,token:_vParams.token,secretNumber:_vParams.secretNumber,commonParam:commonParam()},function(i){i.success&&i.fileList.forEach(function(i){e.l_file.push({id:i.id,fileName:i.fileName,fileSize:i.fileSize,fileUrl:i.fileUrl,lineNo:i.lineNo})})})}var i=this,r="";$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"roId":'+_vParams.roId+',"companyId":'+_vParams.companyId+","+i.tokens+',"serviceId":"B03_findRoLineList", "commonParam":'+i.commonParam+"}"},success:function(i){if(i=i||{},i.success){$scope.roLineList=i.roLineList,L=$scope.roLineList.length,r+='<h2 class="m-title">收货产品</h2>';for(var o=0;L>o;o++){var s=!0;$scope.roLineList[o].receiveUnitName==$scope.roLineList[o].valuationUnitName&&(s=!1),r+='<div class="item-wrap">	<ul>		<li><span>收货产品：</span><p>'+$scope.roLineList[o].prodName+" "+$scope.roLineList[o].prodScale+"</p></li>		<li><span>来源单据：</span><p>采购单："+$scope.roLineList[o].sourcePoNo+"-"+$scope.roLineList[o].sourcePoLineNo+(""==$scope.roLineList[o].sourceDoNo?"":"<br>送货单："+$scope.roLineList[o].sourceDoNo+"-"+$scope.roLineList[o].sourceDoLineNo)+"</p></li>		<li><span>收货批号：</span>"+$scope.roLineList[o].batchNo+"</li>		<li><span>收货数量：</span>"+($scope.roLineList[o].receiveQty||0)+$scope.roLineList[o].receiveUnitName+(s?"/"+($scope.roLineList[o].receiveValuationQty||0)+$scope.roLineList[o].valuationUnitName:"")+"</li>		<li><span>验退数量：</span>"+($scope.roLineList[o].prQty||0)+$scope.roLineList[o].receiveUnitName+(s?"/"+($scope.roLineList[o].prValuationQty||0)+$scope.roLineList[o].valuationUnitName:"")+"</li>		<li><span>收货仓库：</span>"+$scope.roLineList[o].invName+"</li>		<li><span>收货库位：</span>"+$scope.roLineList[o].locationName+"</li>		<li><span>备注：</span><p>"+$scope.roLineList[o].remark+'</p></li>		<li class="files"><span>附件：</span></li>	</ul></div>',e($scope.roLineList[o])}$(".receivOrderOrderDetail").html(r),$scope.roLineList.forEach(function(e,i){var r="<p>";e.l_file.forEach(function(e){r+='<a href="'+e.fileUrl+'"><i class=i-'+(_reg.test(e.fileName)?"image":"word")+"></i>"+e.fileName+"</a>"}),r+="</p>",$(".receivOrderOrderDetail .files").eq(i).html("<span>附件：</span>"+r).show()})}else fnTip.hideLoading(),container.show().html('<p style="line-height:2rem; text-align:center">'+i.errorMsg+"</p>")}})},remark:function(){var e="",i="<p>";e+='<h2 class="m-title">备注</h2>	<div class="item-wrap">		<ul>			<li><span>备注信息：</span>'+$scope.orderInfo.remark+'</li>			<li class="files"><span>附件：</span></li>		</ul>	</div>',$(".remarks").html(e);var r={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B01_findFileList",companyId:$scope.orderInfo.companyId,id:_vParams.roId,commonParam:commonParam(),docType:"15",fileSource:1,searchType:1};GetAJAXData("POST",r,function(e){e.success&&($fileData=e.fileList,$fileData.forEach(function(e){i+='<a href="'+e.fileUrl+'"><i class=i-'+(_reg.test(e.fileName)?"image":"word")+"></i>"+e.fileName+"</a>"}),i+="</p>",$(".remarks .files").html("<span>附件：</span>"+i).show())})},start:function(){var e=this;e.orderHead(),e.orderBody(),setTimeout(function(){fnTip.hideLoading()},0),e.remark()}};