var formTip='<div id="formTip" class="formTip"></div>',$itemTips=$(".item-tips"),container=$(".contarin"),orderReviseInfoCon=$("#orderReviseInfoCon"),_vParams=JSON.parse(decodeURI(getQueryString("param"))),Lists=function(){this.init()};Lists.prototype={init:function(){var a=this;a._files=[],a._lineLists=[],a._othersCost=[],a.totals=0,a.load=!1,a.memberId="",requestFn("B03_POCType",function(e){"0"==e.errorCode&&(a.changeType=e.dataSet.data.detail)}),a.start(),a.hideTip(),$(".item-total").html("总金额：&yen;"+formatMoney(a.totals)).show(),$(".item-total-dj").html("答交总金额：&yen;"+formatMoney(a.reCostTotalFn())).show()},orderBaseInfo:function(){var a=this,e="",t={serviceId:"B03_getPocNoticeInfo",companyId:_vParams.companyId,id:_vParams.id,commonParam:commonParam(),token:_vParams.token,secretNumber:_vParams.secretNumber};return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:"param="+JSON.stringify(t),success:function(t){t=t||{},t.success&&(a.orderInfo=t.pocNoticeInfo,e+='<h2 class="m-title">基本信息</h2><div class="item-wrap">	<ul>		<li><span>平台变更单号：</span><b>'+a.orderInfo.pocFormNo+"</b></li>		<li><span>内部变更单号：</span><b>"+a.orderInfo.pocInsideNo+"</b></li>		<li><span>供应商：</span>"+a.orderInfo.vendorName+"</li>		<li><span>变更类型：</span>"+enumFn(a.changeType,a.orderInfo.changeType)+"</li>		<li><span>变更日期：</span>"+transDate(a.orderInfo.pocFormDate)+"</li>	</ul></div>")}}),e},fileList:function(){var a=this,e=/^(\s|\S)+(jpg|jpeg|png|gif|bmp|JPG|JPEG|PNG|GIF|BMP)+$/;if(a.load){var t={secretNumber:_vParams.secretNumber,token:_vParams.token,serviceId:"B01_findFileList",companyId:_vParams.companyId,fileSource:"1",searchType:"1",id:_vParams.id,docType:_vParams.docType};$.ajax({type:"POST",url:config.serviceUrl,data:"param="+JSON.stringify(t),success:function(a){if(a=a||{},a.success)for(var t=a.fileList,n=0,s=t.length;s>n;n++)""!=t[n].fileName&&$(".files").eq(n).html('<span>附件：</span><a href="'+t[n].fileUrl+'"><i class=i-'+(e.test(t[n].fileName)?"image":"word")+"></i>"+t[n].fileName+"</a>").show()}})}},prodBodyInfo:function(){var a=this,e="",t={serviceId:"B03_findPocNoticeLineList",companyId:_vParams.companyId,pocId:_vParams.pocId,commonParam:commonParam(),token:_vParams.token,secretNumber:_vParams.secretNumber};return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:"param="+JSON.stringify(t),success:function(t){if(t=t||{},t.success){var n=t.pocNoticeLineList;a._lineLists=n,e='<h2 class="m-title">产品信息</h2>';for(var s=0,o=n.length;o>s;s++)e+='<div class="item-wrap" data-index="'+s+'">	<ul>		<li class="prodCode" data-prodCode="'+n[s].prodCode+'" data-prodId="'+n[s].prodId+'"><span>物料编码：</span><b>'+n[s].prodCode+"</b></li>		<li><span>物料详细：</span><p>"+n[s].prodName+"</p></li>		<li><section><span>数量：</span><em>"+n[s].purchaseQty+"</em>"+n[s].purchaseUnitName+"/<em>"+n[s].valuationQty+"</em>"+n[s].valuationUnitName+"</section><section><span>交期：</span><em>"+transDate(n[s].expectedDelivery)+'</em></section></li>		<li class="changeItem"><section><span>变更：</span><em>'+n[s].changeQty+"</em>"+n[s].purchaseUnitName+"/<em>"+n[s].changeValuationQty+"</em>"+n[s].valuationUnitName+"</section><section><span>交期：</span><em>"+transDate(n[s].changeExpectedDelivery)+'</em></section></li>		<li class="price"><span>单价：</span>&yen; '+formatMoney(n[s].taxPrice)+"/"+n[s].valuationUnitName+"</li>		<li><span>备注：</span><p>"+n[s].remark+'</p></li>		<li class="files"><span>附件：</span></li>		<li class="subtotal"><span>小计：</span><b>&yen; '+formatMoney(n[s].taxLineTotal)+"</b></li>"+(""!=n[s].changeTaxLineTotal?'<li class="changeItem"><span>变更金额：</span>&yen; '+formatMoney(n[s].changeTaxLineTotal)+"</li>":"")+"	</ul></div>",a.totals+=parseInt(n[s].taxLineTotal,10);a.load=!0,setTimeout(function(){$(".contarin").show(),fnTip.hideLoading()},0)}}}),e},othersCost:function(){var a=this,e="",t=0,n=0,s=!1;if(a.load){var o={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B03_findPocNoticeOtherCostList",companyId:_vParams.companyId,pocId:_vParams.pocId,commonParam:commonParam()};return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:"param="+JSON.stringify(o),success:function(o){if(o=o||{},o.success){var i=o.costList;a._othersCost=i,e='<h2 class="m-title">其他费用</h2><div class="item-wrap" data-index="0"><ul>';for(var r=0,c=i.length;c>r;r++)e+='<li data-costAmount="'+i[r].costAmount+'" data-vCostAmount="'+i[r].changeCostAmount+'"><span>'+i[r].costName+"：</span><b>&yen; "+formatMoney(i[r].costAmount)+'</b><b class="dj"><em class="money" data-money="'+(""==i[r].changeCostAmount?i[r].costAmount:i[r].changeCostAmount)+'">'+(""==i[r].changeCostAmount?"":formatMoney(i[r].changeCostAmount))+"</em></b></li>",t+=parseInt(i[r].costAmount,10),n+=parseInt(""==i[r].changeCostAmount?i[r].costAmount:i[r].changeCostAmount,10),""!=i[r].changeCostAmount&&(s=!0);e+='<li id="othersCostSubtotal" class="subtotal" data-total="'+t+'" data-vTotal="'+(s?n:t)+'"><span>小计：</span><b>&yen; '+formatMoney(t)+"</b></li>",s&&(e+='<li id="changeCost" class="response"><span>变更费用：</span>&yen; '+formatMoney(n)+"</li>"),e+="</ul>",e+="</div>",a.totals+=parseInt(t,10)}}}),e}},hideTip:function(){$body.on("focus",'input[type="text"]',function(){$("#formTip").removeClass("formTipShow")})},reCostTotalFn:function(){var a=0;return $(".contarin").find(".subtotal").each(function(){a+=parseInt($(this).attr("data-vtotal"),10)}),a},start:function(){var a=this,e=document.getElementById("orderHeadInfo"),t=document.getElementById("prodBodyInfo"),n=document.getElementById("othersCost");e&&(e.innerHTML=a.orderBaseInfo()),t&&(t.innerHTML=a.prodBodyInfo(),a.fileList()),n&&(n.innerHTML=a.othersCost()),bottomBar(["share"],a.memberId,"","确认发布"),container.on("click","a.item-link",function(){var e=$(this),t=e.attr("name"),n=$body.scrollTop();switch(t){case"payInfo":orderReviseInfoCon.html(a.payInfo(n));break;case"remark":orderReviseInfoCon.html(a.remark(n)),$("#intRemarks").val($("#vRemark").val())}$body.scrollTop(0),container.addClass("contarinEdit"),$("#jBottom").addClass("m-bottom-hide")}).on("click",".btn-wrap .btnB",function(){var a=$(this),e=a.attr("data-scrollTop");a.is("#saveRemark")&&$("#vRemark").val($("#intRemarks").val()),container.removeClass("contarinEdit"),$("#jBottom").removeClass("m-bottom-hide"),setTimeout(function(){$body.scrollTop(e)},200)}),$body.on("click",".bottom-btn",function(){a.submitFn()})},payInfo:function(a){var e=this,t=e.orderInfo;requestFn("B02_LogisticsType",function(a){"0"==a.errorCode&&(e.logisticsType=a.dataSet.data.detail)}),requestFn("B02_InvoiceType",function(a){"0"==a.errorCode&&(e.invoiceType=a.dataSet.data.detail)});var n='<ul class="payInfoList"><li><span>交易条件：</span><p>'+t.conditionName+"</p></li><li><span>物流方式：</span><p>"+enumFn(e.logisticsType,t.logisticsType)+("3"==t.logisticsType?"（自提点："+t.address+"）":"")+"</p></li><li><span>收货地址：</span><p>"+t.address+"；"+(""==t.mobile?"":"<br>电话："+t.mobile)+"</p></li><li><span>付款条件：</span><p>"+t.payWayName+"</p></li><li><span>发票类型：</span><p>"+enumFn(e.invoiceType,t.invoiceType)+"</p></li><li><span>发票抬头：</span><p>"+t.invoiceHeader+"</p></li><li><span>发票类容：</span><p>"+t.invoiceContent+'</p></li></ul><div class="btn-wrap"><a href="javascript:;" class="btnB" data-scrollTop="'+a+'">完成</a></div>';return n},remark:function(a){var e=this,t='<div class="remarks-wrap"><div id="provisions" class="item-wrap clause">	<h2>补充条款：</h2>	<p>'+e.orderInfo.agreement+'</p></div><div id="taRemarks" class="item-wrap taRemarks">	<h2>备注信息：</h2>	<p>'+e.orderInfo.remark+'</p></div><div id="files" class="item-wrap attachment">	<h2>订单附件：</h2></div><div class="item-wrap int-remarks">	<textarea name="" id="intRemarks" placeholder="填写我方备注"></textarea></div></div></div><div class="btn-wrap"><a href="javascript:;" id="saveRemark" class="btnB" data-scrollTop="'+a+'">完成</a></div>';return t},submitFn:function(){}};