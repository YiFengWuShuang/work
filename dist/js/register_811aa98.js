var $formTip=$("#formTip"),Reg=function(){this.clickNum=0,this.countdown=60,this.init()};Reg.prototype={init:function(){var i=this;$("form input.required").blur(function(){i.validateFn($(this))}),$("form .btnBig").on("click",function(){var o=$(this);if(!o.hasClass("btnBig-g")){var e=o.parent("form").find("input.required");i.validateFn(e);var t=$(".formTipShow").length;if(t)return!1;if(o.is("#btn-getCode")){if(!$("#clauseChecked").prop("checked"))return $formTip.html("您未勾选《用户使用协议》").addClass("formTipShow"),!1;var r=$("#phone").val(),n=getQueryString("inviteCode");if(fnTip.loading(),i.checkAccount(r))return;i.settime(o,"免费获取验证码"),$.ajax({type:"POST",dataType:"json",async:!1,url:config.ussUrl+"/login/getSmsVerifyCode/v1",data:JSON.stringify({mobile:r}),success:function(i){return fnTip.hideLoading(),i=i||{},"01250"!=i.retCode?(console.log(i.retMsg),!1):void o.attr("href",config.htmlUrl+"invitationReg2.html?&mobile="+r+"&inviteCode="+n)}})}if(o.is("#btn-next")){var r=getQueryString("mobile"),a=$("#validateCode").val().trim(),n=getQueryString("inviteCode");fnTip.loading(),i.clickNum++,i.clickNum>3&&i.settime(o,"下一步"),$.ajax({type:"POST",dataType:"json",async:!1,url:config.ussUrl+"/recover_password/checkSmsVerifyCode/v1",data:JSON.stringify({mobile:r,smsVerifyCode:a}),success:function(e){return fnTip.hideLoading(),e=e||{},"0"!=e.errorCode?"01443"==e.errorCode?($formTip.html("手机验证码不正确").addClass("formTipShow"),!1):(console.log(e.errorMsg),!1):(i.clickNum=0,void o.attr("href",config.htmlUrl+"invitationReg3.html?&mobile="+r+"&inviteCode="+n))}})}if(o.is("#btn-end")){var r=getQueryString("mobile"),n=getQueryString("inviteCode"),s=$("#psw-1").val(),l=$("#psw-2").val();s=faultylabs.MD5(faultylabs.MD5(s)),l=faultylabs.MD5(faultylabs.MD5(l)),fnTip.loading(),i.clickNum++,i.clickNum>3&&i.settime(o,"完成"),$.ajax({type:"POST",dataType:"json",async:!1,url:config.ussUrl+"/register/registerAccountOnMobile/v1",data:JSON.stringify({mobile:r,invitationCode:n,password:s,confirmPassWd:l,dataSource:dataSource()}),success:function(e){return fnTip.hideLoading(),e=e||{},"0"!=e.errorCode?"02145"==e.errorCode?($formTip.html("输入密码不一致").addClass("formTipShow"),!1):(console.log(e.errorMsg),!1):(i.clickNum=0,void o.attr("href",config.htmlUrl+"join.html?&companyName="+e.companyName))}})}o.is("#btn-login"),o.is("#btn-reg")}})},validateFn:function(i){i.each(function(){var i=$(this);if(i.is("#phone")){if(""==i.val()||""!=i.val()&&!/^[1][3578][0-9]{9}$/.test(i.val())){var o="手机号码格式不正确";return $formTip.html(o).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}if(i.is("#validateCode")){var e=i.val();if(""==e){var o="手机验证码不能为空";return $formTip.html(o).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}if(i.is("#psw-1")){if(""==i.val()||""!=i.val()&&!/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/.test(i.val())){var o="密码不能为空或格式不正确";return $formTip.html(o).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}if(i.is("#psw-2")){var t=$("#psw-1").val();if(""==i.val()||i.val()!=t){var o="输入密码不一致";return $formTip.html(o).addClass("formTipShow"),!1}$formTip.removeClass("formTipShow")}})},checkAccount:function(i){var o=!0;return $.ajax({type:"POST",dataType:"json",async:!1,url:config.ussUrl+"/register/checkAccount/v1",data:JSON.stringify({account:i}),success:function(i){fnTip.hideLoading(),i=i||{},"01110"==i.retCode?o=!1:"01111"==i.retCode?($formTip.html("用户名已注册").addClass("formTipShow"),o=!0):($formTip.html("操作失败").addClass("formTipShow"),o=!0)}}),o},settime:function(i,o){var e=this;0==e.countdown?(i.removeClass("btnBig-g"),i.html(o),e.countdown=60):(i.addClass("btnBig-g"),i.html("重新操作("+e.countdown+")"),e.countdown--,setTimeout(function(){e.settime(i,o)},1e3))}};