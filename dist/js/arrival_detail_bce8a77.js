var _vParams=JSON.parse(decodeURI(getQueryString("param"))),container=$(".contarin"),$scope={},arrivalOrder=function(){this.init()};arrivalOrder.prototype={init:function(){function e(){var e="",a={serviceId:"B03_getDeliveryOrderNoticeInfo",token:_vParams.token,secretNumber:_vParams.secretNumber,doId:_vParams.doId,companyId:_vParams.companyId,commonParam:commonParam()};GetAJAXData("POST",a,function(a){a.success?(success=!0,$scope.orderInfo=a.deliveryOrderNotic,e+='<h2 class="m-title">基础信息</h2>	<div class="item-wrap">		<ul>			<li><span>出货日期：</span>'+$scope.orderInfo.doFormDate+"</li>			<li><span>预计送达时间：</span><b>"+$scope.orderInfo.planDeliveryDate+"</b></li>			<li><span>到货地址：</span>"+$scope.orderInfo.address+"</li>		</ul>	</div>",$(".orderInfo").html(e)):(container.html('<p style="text-align:center;">'+a.errorMsg+"</p>"),success=!1)})}function a(e){e.l_file=[],GetAJAXData("POST",{serviceId:"B01_findFileList",docType:"26",companyId:_vParams.companyId,searchType:2,id:e.rolineId,token:_vParams.token,secretNumber:_vParams.secretNumber,commonParam:commonParam()},function(a){a.success&&a.fileList.forEach(function(a){e.l_file.push({id:a.id,fileName:a.fileName,fileSize:a.fileSize,fileUrl:a.fileUrl,lineNo:a.lineNo})})})}function i(){var e="",i={serviceId:"B03_findDoNoticeLineList",token:_vParams.token,secretNumber:_vParams.secretNumber,doId:_vParams.doId,companyId:_vParams.companyId,commonParam:commonParam()};GetAJAXData("POST",i,function(i){i.success?($scope.doNotLineList=i.doNotLineList,e+='<h2 class="m-title">到货产品</h2>',$scope.doNotLineList.forEach(function(i){var o=!0;i.deliveryUnitName==i.valuationUnitName&&(o=!1),e+='<div class="item-wrap">		<ul>			<li><span>送货产品：</span><p>'+i.prodCode+"<br>"+i.prodName+" "+i.prodScale+"</p></li>			<li><span>采购单号：</span>"+i.sourcePoNo+"-"+i.sourcePoLineNo+"</li>			<li><span>本次送货数量：</span>"+(i.deliveryQty||0)+i.deliveryUnitName+(o?"/"+(i.deliveryValuationQty||0)+i.valuationUnitName:"")+"</li>			<li><span>送货批号：</span>"+i.batchNo+"</li>			<li><span>已签收数量：</span>"+(i.receiveQty||0)+i.deliveryUnitName+(o?"/"+(i.receiveValuationQty||0)+i.valuationUnitName:"")+"</li>			<li><span>备注：</span>"+i.lineRemark+'</li>			<li class="file"><span>附件：</span></li>		</ul>	</div>',a(i)}),$(".receivOrderDetail").html(e),$scope.doNotLineList.forEach(function(e,a){var i="<p>";e.l_file.forEach(function(e){i+='<a href="'+e.fileUrl+'"><i class=i-'+(_reg.test(e.fileName)?"image":"word")+"></i>"+e.fileName+"</a>"}),i+="</p>",$(".receivOrderDetail .files").eq(a).html("<span>附件：</span>"+i).show()})):container.html('<p style="text-align:center;">'+i.errorMsg+"</p>")})}function o(){var e="",a="<p>",i=[];requestFn("B02_LogisticsType",function(e){"0"==e.errorCode&&(i=e.dataSet.data.detail)}),e+='<h2 class="m-title">物流和备注</h2>	<div class="item-wrap">		<ul>			<li><span>物流方式：</span>'+enumFn(i,$scope.orderInfo.logisticsType)+"</li>			<li><span>物流商：</span>"+$scope.orderInfo.logisticsName+"</li>			<li><span>物流单号：</span><p>"+($scope.orderInfo.logisticsNo||"-- ")+" 联系人："+$scope.orderInfo.contactPerson+"，联系方式："+$scope.orderInfo.mobile+"</p></li>			<li><span>备注信息：</span>"+$scope.orderInfo.remark+'</li>			<li class="files"><span>出货附件：</span></li>		</ul>	</div>',$(".remarks").html(e);var o={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B01_findFileList",companyId:_vParams.companyId,id:_vParams.doId,commonParam:commonParam(),docType:"26",searchType:1};GetAJAXData("POST",o,function(e){e.success&&($fileData=e.fileList,$fileData.forEach(function(e){a+='<a href="'+e.fileUrl+'"><i class=i-'+(_reg.test(e.fileName)?"image":"word")+"></i>"+e.fileName+"</a>"}),a+="</p>",$(".remarks .files").html("<span>附件：</span>"+a).show())})}var r=this;setTimeout(function(){fnTip.hideLoading(),container.show()},0),e(),i(),o(),bottomBar(["share"],$scope.orderInfo.deliveryManId,"","收货"),$body.on("click",".bottom-btn-confirm",function(){r.popup("confirm","","确定要收货吗？",function(){},function(){return isAndroidMobileDevice()&&window.WebViewJavascriptBridge?window.WebViewJavascriptBridge.callHandler("goodsReceive",{param:$scope.orderInfo.doFormNo},function(){}):setupWebViewJavascriptBridge(function(e){e.callHandler("goodsReceive",{param:$scope.orderInfo.doFormNo},function(){})}),!1})})},popup:function(e,a,i,o,r){new Popup({type:e,title:a,content:i,ok:"确定",cancel:"取消",closeCallBack:o,okCallBack:r})}};