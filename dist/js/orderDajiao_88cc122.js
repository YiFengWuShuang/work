var formTip='<div id="formTip" class="formTip"></div>',$itemTips=$(".item-tips"),container=$(".contarin"),orderReviseInfoCon=$("#orderReviseInfoCon"),orderAnswerCon=$("#orderAnswerInfo"),prodAnswerCon=$("#prodAnswerInfo"),othersCostCon=$("#othersCost"),$scope={},$platformCurrencyList,$currencySymbol,$priceDecimalNum,$amountDecimalNum,$prodMapList=[],$fileData,$btnTxet="分批答交",_vParams=JSON.parse(decodeURI(getQueryString("param"))),_reg=/^(\s|\S)+(jpg|jpeg|png|gif|bmp|JPG|JPEG|PNG|GIF|BMP)+$/,orderDajiao=function(){this.init()};orderDajiao.prototype={init:function(){$scope.delPoOthreCostList=[],$scope.addPoFileList=[],$scope.delPoFileList=[],setTimeout(function(){container.show(),fnTip.hideLoading()},0),this.start()},start:function(){function e(){var e="",o={serviceId:"B03_getPurchaseOrderAnswerInfo",token:_vParams.token,secretNumber:_vParams.secretNumber,poAnswerId:_vParams.poAnswerId,vendorId:_vParams.vendorId,commonParam:commonParam()};GetAJAXData("POST",o,function(o){if(o.success){$scope.orderInfo=o.poAnswerOrderInfo,n=!0,e+='<h2 class="m-title">基础信息</h2><div class="item-wrap">	<ul>		<li><span>平台单号：</span><b>'+$scope.orderInfo.poFormNo+"</b></li>		<li><span>内部单号：</span><b>"+$scope.orderInfo.poInsideNo+"</b></li>		<li><span>客户：</span><b>"+$scope.orderInfo.companyCode+"-"+$scope.orderInfo.companyAbbr+"</b></li>		<li><span>交易币别：</span>"+$scope.orderInfo.currencyName+"</li>		<li><span>交易税别：</span>"+$scope.orderInfo.taxName+'<label class="checkbox'+(1==$scope.orderInfo.isContainTax?" on":"")+'"><input type="checkbox" checked="checked" disabled>含税'+100*$scope.orderInfo.taxRate+"%</label></li>		<li><span>交易条件：</span>"+$scope.orderInfo.conditionName+"</li>		<li><span>付款条件：</span>"+$scope.orderInfo.payWayName+"</li>		<li><span>采购日期：</span>"+$scope.orderInfo.poFormDate+"</li>	</ul></div>",$("#orderInfo").html(e),$scope.orderInfo.cOtherCostTotal=$scope.orderInfo.cOtherCostTotal?$scope.orderInfo.cOtherCostTotal:0,$scope.orderInfo.vOtherCostTotal=$scope.orderInfo.vOtherCostTotal?$scope.orderInfo.vOtherCostTotal:0;var r={serviceId:"B01_queryAllPlatformCurrency",token:_vParams.token,secretNumber:_vParams.secretNumber,commonParam:commonParam()};GetAJAXData("POST",r,function(e){if(e.success){$platformCurrencyList=e;for(var o=0,r=e.platformCurrencyList.length;r>o;o++)if(e.platformCurrencyList[o].currencyCode==$scope.orderInfo.pCurrencyCode)return $currencySymbol=e.platformCurrencyList[o].currencySymbol,$priceDecimalNum=e.platformCurrencyList[o].priceDecimalNum,$amountDecimalNum=e.platformCurrencyList[o].amountDecimalNum,!1}})}else container.html('<p style="text-align:center;">'+o.errorMsg+"</p>"),n=!1})}function o(){var e="",o={serviceId:"B03_findPoAnswerLineList",token:_vParams.token,secretNumber:_vParams.secretNumber,poAnswerId:_vParams.poAnswerId,vendorId:_vParams.vendorId,commonParam:commonParam()};GetAJAXData("POST",o,function(o){o.success?($scope.poLineList=o.poLineList,n=!0,e+='<h2 class="m-title">产品明细</h2>',$scope.poLineList.forEach(function(o,r){o.vProdName?o.vPurchaseQty||(o.vPurchaseQty=o.purchaseQty,o.vValuationQty=o.valuationQty,o.vExpectedDelivery=o.expectedDelivery,o.vAnswerUnitName=o.purchaseUnitName,o.vAnswerUnitId=o.purchaseUnitId,o.vAnswerUnitCode=o.purchaseUnitCode,o.vValuationUnitId=o.valuationUnitId,o.vValuationUnitCode=o.valuationUnitCode,o.vValuationUnitName=o.valuationUnitName,o.vPrice=o.price,o.vTaxPrice=o.taxPrice,o.vLineAmount=o.lineAmount,o.vTaxLineTotal=o.taxLineTotal):(o.vPurchaseQty=o.purchaseQty,o.vValuationQty=o.valuationQty,o.vExpectedDelivery=o.expectedDelivery,o.vAnswerUnitName=o.purchaseUnitName,o.vAnswerUnitId=o.purchaseUnitId,o.vAnswerUnitCode=o.purchaseUnitCode,o.vValuationUnitId=o.valuationUnitId,o.vValuationUnitCode=o.valuationUnitCode,o.vValuationUnitName=o.valuationUnitName,o.vPrice=o.price,o.vTaxPrice=o.taxPrice,o.vLineAmount=o.lineAmount,o.vTaxLineTotal=o.taxLineTotal,GetAJAXData("POST",{serviceId:"B01_getProdByCustomerProd",token:_vParams.token,secretNumber:_vParams.secretNumber,vendorId:_vParams.vendorId,cProdCode:o.prodCode,commonParam:commonParam(),customerId:$scope.orderInfo.companyId},function(e){e.prodMap?(o.vProdId=e.prodMap.prodId,o.vProdCode=e.prodMap.prodCode,o.vProdName=e.prodMap.prodName,o.vProdScale=e.prodMap.prodScale,o.vProdDesc=e.prodMap.prodDesc):(o.vProdName=o.prodName,o.vProdScale=o.prodScale,o.vProdDesc=o.prodDesc)})),o.defaultvPurchaseQty=o.vPurchaseQty,o.defaultvValuationQty=o.vValuationQty,o.defaultvExpectedDelivery=o.vExpectedDelivery,e+='<div class="item-wrap" data-index="'+r+'">	<ul>		<li><span>物料编码：</span><b>'+o.prodCode+"</b></li>		<li><span>物料详细：</span><p>"+o.prodName+" "+o.prodScale+"</p></li>"+(4!=$scope.orderInfo.vStatus?"<li><section><span>客户数量：</span><em>"+o.purchaseQty+"</em>"+o.purchaseUnitName+"/<em>"+o.valuationQty+"</em>"+o.valuationUnitName+"</section><section><span>交期：</span><em>"+o.expectedDelivery+"</em></section></li>":"")+(1==$scope.orderInfo.vStatus?"":0==o.poSubLineList.length?'<li class="bfline"><section><span>本方数量：</span><em>'+o.vPurchaseQty+"</em>"+o.vAnswerUnitName+"/<em>"+o.valuationQty+"</em>"+o.vValuationUnitName+"</section><section><span>交期：</span><em>"+o.vExpectedDelivery+"</em></section></li>":"");for(var t=0;t<o.poSubLineList.length;t++)e+='<li class="response"><section><span'+(0==t?' class="nth0"':"")+">分批答交：</span><em>"+o.poSubLineList[t].purchaseQty+"</em>"+o.purchaseUnitName+"/<em>"+o.poSubLineList[t].valuationQty+"</em>"+o.valuationUnitName+"</section><section><span"+(0==t?' class="nth0"':"")+'>交期：</span><em class="expectedDelivery">'+o.poSubLineList[t].expectedDelivery+"</em></section></li>";e+='		<li class="price"><span>单价：</span>'+$currencySymbol+formatMoney(1===$scope.orderInfo.isContainTax?o.taxPrice:o.price)+"/"+o.valuationUnitName+"</li>		<li><span>备注：</span><p>"+o.remark+'</p></li>		<li class="files"><span>附件：</span></li>		<li class="subtotal"><span>含税小计：</span><b>'+$currencySymbol+formatMoney(o.taxLineTotal)+"</b></li>"+(1!=$scope.orderInfo.vStatus&&4!=$scope.orderInfo.vStatus?'<li class="response responseTotal"><span>答交小计：</span>'+$currencySymbol+formatMoney(o.vTaxLineTotal)+"</li>":"")+"	</ul>"+(2==$scope.orderInfo.vStatus?'<span class="edit"></span>':"")+"</div>"}),$("#linelist").html(e)):container.html('<p style="text-align:center;">'+o.errorMsg+"</p>")})}function r(){var e='<h2 class="m-title">其他费用</h2><div class="item-wrap"><ul>',o={serviceId:"B03_findPoAnswerOtherCostList",token:_vParams.token,secretNumber:_vParams.secretNumber,poAnswerId:_vParams.poAnswerId,vendorId:_vParams.vendorId,commonParam:commonParam()};GetAJAXData("POST",o,function(o){o.success&&($scope.otherCost=o.poOthreCostList,$scope.otherCost.forEach(function(o){o.vCostAmount&&0!=o.vCostAmount||(o.vCostAmount=o.costAmount,$scope.orderInfo.vOtherCostTotal=$scope.orderInfo.cOtherCostTotal),e+='<li class="mobiCostItem costItem"><span>'+o.costName+"：</span><b>"+$currencySymbol+formatMoney(o.costAmount)+"</b>"+(1==$scope.orderInfo.vStatus?"":'<b class="dj"><em class="money">'+formatMoney(o.vCostAmount)+"</em></b>")+"</li>"}),e+='<li id="othersCostSubtotal" class="subtotal"><span>客户小计：</span><b>'+$currencySymbol+formatMoney($scope.orderInfo.cOtherCostTotal)+"</b></li>",1!=$scope.orderInfo.vStatus&&(e+='<li id="changeCost" class="response"><span>本方小计：</span>'+$currencySymbol+formatMoney($scope.orderInfo.vOtherCostTotal)+"</li>"),e+="</ul>",e+=2==$scope.orderInfo.vStatus?'<span class="edit editOther"></span>':"",e+="</div>",$("#othersCost").html(e),$scope.otherCost.sort(function(e,o){return e.lineNo-o.lineNo}))})}function t(e){$scope.orderFileList=[];var o={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B01_findFileList",docType:24,searchType:1,fileSource:2,companyId:$scope.orderInfo.vendorId,id:e};GetAJAXData("POST",o,function(e){e.success&&($scope.orderFileList=[],e.fileList.forEach(function(e){$scope.orderFileList.push({id:e.id,fileName:e.fileName,fileSize:e.fileSize,fileUrl:e.fileUrl,lineNo:e.lineNo})}))})}function a(e){$scope.orderCustomerFileList=[];var o={token:_vParams.token,secretNumber:_vParams.secretNumber,serviceId:"B01_findFileList",docType:24,searchType:1,fileSource:2,companyId:$scope.orderInfo.vendorId,id:e};GetAJAXData("POST",o,function(e){e.success&&($scope.orderCustomerFileList=[],e.fileList.forEach(function(e){$scope.orderCustomerFileList.push({id:e.id,fileName:e.fileName,fileSize:e.fileSize,fileUrl:e.fileUrl,lineNo:e.lineNo})}))})}var n=!0;e(),o(),r(),t($scope.orderInfo.id),a($scope.orderInfo.id)}};