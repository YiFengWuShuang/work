var _vParams=JSON.parse(decodeURI(getQueryString("param"))),container=$(".contarin"),orderReviseInfoCon=$("#orderReviseInfoCon"),deliveryOrder=function(){this.init()};deliveryOrder.prototype={init:function(){this.commonParam=JSON.stringify(commonParam()),this.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',this.start()},orderHead:function(){var a=this,e="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"doId":"'+_vParams.doId+'","companyId":"'+_vParams.companyId+'",'+a.tokens+',"serviceId":"B03_getDeliveryOrderInfo", "commonParam":'+a.commonParam+"}"},success:function(r){r=r||{},r.success&&(a.orderInfo=r.deliveryOrder,e+='<div class="m-item">	<div class="item-wrap">		<ul>			<li><span>客户：</span>'+a.orderInfo.customerName+"</li>			<li><span>出货单号：</span><b>"+a.orderInfo.doFormNo+"</b></li>			<li><span>出货日期：</span>"+a.orderInfo.doFormDate+"</li>			<li><span>出货人：</span>"+a.orderInfo.deliveryManName+"</li>			<li><span>预计送达：</span>"+a.orderInfo.planDeliveryDate+'</li>		</ul>	</div></div><div class="m-item deliveryOrderDetail"></div><a href="javascript:;" class="item-wrap item-link">物流单号：'+a.orderInfo.logisticsNo+'<span class="arrow_down"></span></a>')}}),e},orderBody:function(){var a=this,e="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"doId":"'+_vParams.doId+'","companyId":"'+_vParams.companyId+'",'+a.tokens+',"serviceId":"B03_findDoLineList", "commonParam":'+a.commonParam+"}"},success:function(a){if(a=a||{},a.success){var r=a.doLineList,i=r.length;e+='<h2 class="m-title">出货明细</h2>';for(var n=0;i>n;n++)e+='<div class="item-wrap">	<ul>		<li><span>采购单号：</span><b>'+r[n].sourcePoNo+"</b></li>		<li><span>物料编码：</span><b>"+r[n].prodCode+"</b></li>		<li><span>物料详细：</span><p>"+r[n].prodDesc+" "+r[n].prodScale+"</p></li>		<li><span>待出货数量：</span>"+r[n].deliveryQty+r[n].deliveryUnitName+"/"+r[n].deliveryValuationQty+r[n].valuationUnitName+"</li>		<li><span>出货数量：</span>"+r[n].deliveryQty+r[n].deliveryUnitName+"/"+r[n].deliveryValuationQty+r[n].valuationUnitName+"</li>		<li><span>出货批号：</span>"+r[n].batchNo+"</li>		<li><span>出货备注：</span><p>"+r[n].remark+"</p></li>	</ul></div>"}}}),e},start:function(){var a=this;$(".deliveryOrder .showItemCon").html(a.orderHead()),$(".deliveryOrderDetail").html(a.orderBody()),setTimeout(function(){fnTip.hideLoading()},0),4==a.orderInfo.vStatus&&bottomBar(["share"],"","","出货"),$body.on("click",".bottom-btn",function(){a.submitFn()})},submitFn:function(){var a=this,e=commonParam();e.secretKey="1",e.joinUpCode="1",$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"deliveryId":"'+_vParams.doId+'","companyId":"'+_vParams.companyId+'",'+a.tokens+',"serviceId":"B03_submitDeliveryOrder","commonParam":'+JSON.stringify(e)+"}"},success:function(a){a=a||{},a.success?fnTip.success(2e3):fnTip.error(2e3)}})}};