var formTip='<div id="formTip" class="formTip"></div>',_vParams=JSON.parse(decodeURI(getQueryString("param"))),OrdersMt=function(){this.init()};OrdersMt.prototype={init:function(){var i=this;i.purchaseUnit=[],i.valuationUnit=[],i.commonParam=JSON.stringify(commonParam()),i.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',i.load=!1,i.memberId="",i.prodId=[],i.start()},orderInfos:function(){var i=this,a="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:"{"+i.tokens+',"serviceId":"B03_findPoAnswerLineList","poAnswerId":"'+_vParams.poAnswerId+'","vendorId":"'+_vParams.vendorId+'","commonParam":'+i.commonParam+" }"},success:function(n){if(n=n||{},n.success){for(var e=n.poLineList,t=0,s=e.length;s>t;t++){var o=e[t],r=o.poSubLineList.length;i.prodId.push(o.prodId),a+='<div class="m-item">	<h2 class="m-title">基本信息</h2>	<div class="item-wrap" data-prod-index="'+t+'">		<ul>			<li><span>物料编码：</span>'+o.prodCode+"</li>			<li><span>物料详细：</span><p>"+o.prodName+" "+o.prodScale+"</p></li>			<li><section><span>数量：</span>"+o.purchaseQty+o.purchaseUnitName+"/"+o.valuationQty+o.valuationUnitName+"</section><section><span>交期：</span>"+o.expectedDelivery+"</section></li>";for(var c=0;r>c;c++){var d=o.poSubLineList[c];a+='<li class="response"><section><span>数量：</span>'+d.purchaseQty+d.purchaseUnit+"/"+d.valuationQty+d.valuationUnit+"</section><section><span>交期：</span>"+d.expectedDelivery+"</section></li>",i.purchaseUnit.push(d.purchaseUnit),i.valuationUnit.push(d.valuationUnit)}a+='			<li><span class="price">单价：</span>&yen; '+o.taxPrice+".00/"+o.valuationUnitName+"</li>			<li><span>备注：</span><p>"+o.remark+'</p></li>		</ul>	</div></div><div class="m-item">	<h2 class="m-title">销售订单信息维护</h2>	<div class="item-wrap">		<section class="clearfix">			<span class="c-label"><b>我方编码：</b></span>			<div class="wfItem">'+o.vProdCode+"				<p>"+o.vProdName+" "+o.vProdScale+'</p>			</div>			<div class="itemEdit">				<input type="text" class="int-search" placeholder="请输入我方编码" />				<div class="btns"><a class="btn-cancel">取消</a><a class="btn-save">确定</a></div>			</div>		</section>';for(var p=0;r>p;p++){var l=o.poSubLineList[p];a+='<section class="m-select clearfix">	<span class="c-label"><b>数量：</b></span>	<div class="c-cont">		<div class="c-cont-item">			<span>'+l.purchaseQty+'</span>			<div id="purchaseQty_'+p+'" class="select3-input"></div>		</div>		<div class="c-cont-item">			<span>'+l.valuationQty+'</span>			<div id="valuationQty_'+p+'" class="select3-input"></div>		</div>	</div></section>'}a+='<span class="edit"></span></div></div>'}i.load=!0,setTimeout(function(){fnTip.hideLoading()},0)}}}),a},units:function(){var i=this,a=[],n=[];$.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"serviceId":"B01_findProdUnitListByProd","companyId":"'+_vParams.companyId+'","prodId":"'+i.prodId[0]+'",'+i.tokens+',"commonParam":'+i.commonParam+"}"},success:function(i){if(i=i||{},i.success)for(var e=i.prodUnitList,t=0,s=e.length;s>t;t++)a.push(e[t].prodUnitName),n.push(e[t].basicUnitName)}});for(var e=$(".m-select").length,t=0;e>t;t++)i.initSelect3("#purchaseQty_"+t,a,i.purchaseUnit[t]),i.initSelect3("#valuationQty_"+t,n,i.valuationUnit[t])},start:function(){var i=this;$("#orderInfoCon").html(i.orderInfos()),i.load&&i.units(),i.editProdCode(),i.hideTip(),bottomBar(["share"],i.memberId),$body.on("click",".bottom-btn",function(){i.submitFn()})},initSelect3:function(i,a,n){$(i).select3({allowClear:!0,items:a,placeholder:"请选择",showSearchInputInDropdown:!1,value:n})},editProdCode:function(){function i(i){var a=i.parents(".item-wrap");a.find(".wfItem").show(),a.find(".itemEdit").hide(),a.find(".edit").show(),$("#formTip").remove()}var a=this;$(".contarin").on("click",".edit",function(){var i=$(this),a=i.parent(".item-wrap");i.hide(),a.find(".wfItem").hide(),a.find(".itemEdit").show(),$body.append(formTip)}).on("click",".btn-save",function(){var n=$(this),e=n.parents(".itemEdit").find(".int-search").val();$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"serviceId": "B01_getProdInfoByCode","companyId":"'+_vParams.companyId+'","vendorId":"'+_vParams.vendorId+'","prodCode":"'+e+'","commonParam":'+a.commonParam+","+a.tokens+"}"},success:function(a){if(a=a||{},a.success){var t=a.prodInfo;e==t.prodCode?(n.parents(".item-wrap").find(".wfItem").html(t.prodCode+"<p>"+t.prodName+" "+t.prodScale+"</p>"),i(n)):$("#formTip").html("产品编码错误，请重新输入").addClass("formTipShow")}}})}).on("click",".btn-cancel",function(){var a=$(this);i(a)})},hideTip:function(){$body.on("focus",'input[type="text"]',function(){$("#formTip").removeClass("formTipShow")})},submitFn:function(){}};