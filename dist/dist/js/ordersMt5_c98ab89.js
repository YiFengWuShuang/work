var _vParams=JSON.parse(decodeURI(getQueryString("param"))),OrdersMt=function(){this.init()};OrdersMt.prototype={init:function(){var a=this;a.commonParam=JSON.stringify(commonParam()),a.tokens='"token":"'+_vParams.token+'","secretNumber":"'+_vParams.secretNumber+'"',a.load=!1,requestFn("B02_LogisticsType",function(s){"0"==s.errorCode&&(a.logisticsType=s.dataSet.data.detail)}),requestFn("B02_InvoiceType",function(s){"0"==s.errorCode&&(a.invoiceType=s.dataSet.data.detail)}),$("#savePayInfoList").before(a.setPayOrderInfo()),a.load&&(a.conditionSelect(),a.LogisticalSelect(),a.address(),a.payWaySelect()),$("#savePayInfoList a").on("click",function(){a.submitFn()})},setPayOrderInfo:function(){var a=this,s="";return $.ajax({type:"POST",async:!1,url:config.serviceUrl,data:{param:'{"serviceId":"B03_getPurchaseOrderAnswerInfo","poAnswerId":"'+_vParams.poAnswerId+'","vendorId":"'+_vParams.vendorId+'",'+a.tokens+',"commonParam":'+a.commonParam+"}"},success:function(e){if(e=e||{},e.success){var c=e.poAnswerOrderInfo;s+='<div id="payInfoList" class="m-item">	<div class="item-wrap">		<ul>			<li><span>交易条件：</span><p id="jyCurrVal" data-conditionId="'+c.conditionId+'">'+c.conditionName+'</p></li>			<li><span>物流方式：</span><p><em id="logisticsVal">'+enumFn(a.logisticsType,c.logisticsType)+"</em>"+("3"==c.logisticsType?"（自提点："+c.address+"）":"")+"</p></li>			<li><span>收货地址：</span><p>"+c.address+"；<br>电话："+c.mobile+'</p></li>			<li><span>付款条件：</span><p id="payWayName" data-payWayId="'+c.payWayId+'">'+c.payWayName+"</p></li>			<li><span>发票类型：</span><p>"+enumFn(a.invoiceType,c.invoiceType)+"</p></li>			<li><span>发票抬头：</span><p>"+c.invoiceHeader+"</p></li>			<li><span>发票类容：</span><p>"+c.invoiceContent+'</p></li>		</ul>	</div></div><div id="rePayInfoList" class="m-item">	<div class="item-wrap">		<section class="m-select clearfix">			<span class="c-label">交易条件：</span>			<div class="c-cont">				<div id="dealType" class="select3-input"></div>			</div>		</section>		<section class="m-select clearfix">			<span class="c-label">物流方式：</span>			<div class="c-cont">				<div id="logisticsType" class="select3-input"></div>			</div>		</section>		<section id="address" class="clearfix" data-companyId="'+c.companyId+'" data-addressId="'+c.addressId+'">			<span class="c-label">收货地址：</span>			<div class="c-cont">				<p class="c-txt">'+c.address+"；<br>电话："+c.mobile+'</p>			</div>		</section>		<section class="m-select clearfix">			<span class="c-label">收款条件：</span>			<div class="c-cont">				<div id="checkoutType" class="select3-input"></div>			</div>		</section>		<section class="clearfix">			<span class="c-label">发票类型：</span>			<div class="c-cont">				<p class="c-txt">'+enumFn(a.invoiceType,c.invoiceType)+'</p>			</div>		</section>		<section class="clearfix">			<span class="c-label">开票抬头：</span>			<div class="c-cont">				<p class="c-txt">'+c.invoiceHeader+'</p>			</div>		</section>		<section class="clearfix">			<span class="c-label">发票内容：</span>			<div class="c-cont">				<p class="c-txt">'+c.invoiceContent+'</p>			</div>		</section>		<section class="clearfix">			<span class="c-label">纳税人识别码：</span>			<div class="c-cont">				<p class="c-txt">'+c.invoicePayMark+'</p>			</div>		</section>		<section class="clearfix">			<span class="c-label">发票电话：</span>			<div class="c-cont">				<p class="c-txt">'+c.invoiceTel+'</p>			</div>		</section>		<section class="clearfix">			<span class="c-label">发票开户行：</span>			<div class="c-cont">				<p class="c-txt">'+c.invoiceBank+'</p>			</div>		</section>		<section class="clearfix">			<span class="c-label">发票账号：</span>			<div class="c-cont">				<p class="c-txt">'+c.invoiceAccount+"</p>			</div>		</section>	</div></div>",a.load=!0,setTimeout(function(){fnTip.hideLoading(),$(".contarin").show()},0)}}}),s},initSelect3:function(a,s,e){$(a).select3({allowClear:!0,items:s,placeholder:"请选择",showSearchInputInDropdown:!1,value:e})},conditionSelect:function(){var a=this,s=[],e="",c=$("#jyCurrVal"),i=c.attr("data-conditionId");$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"companyId":"'+_vParams.companyId+'","serviceId":"B01_getConditionByCustomerCondition",'+a.tokens+',"commonParam":'+a.commonParam+',"customerId":"'+_vParams.customerId+'","cConditionId":"'+i+'"}'},success:function(a){a=a||{},e=a.success?a.conditionName:c.html()}}),$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"serviceId":"B01_findCompanyConditionList",'+a.tokens+',"companyId":"'+_vParams.companyId+'","conditionType":"2"}'},success:function(c){if(c=c||{},c.success){for(var i=c.conditionList,n=i.length,t=0;n>t;t++)s.push(i[t].conditionName);a.initSelect3("#dealType",s,e)}}})},LogisticalSelect:function(){var a=this,s=[];a.logisticsType.forEach(function(a){s.push(a.Value)});var e=$("#logisticsVal").html();a.initSelect3("#logisticsType",s,e)},address:function(){var a=this,s=$("#address"),e=s.attr("data-companyId"),c=s.attr("data-addressId");$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"type":"1","companyId":"'+_vParams.companyId+'","customerId":"'+e+'","cAddressId":"'+c+'",'+a.tokens+',"serviceId":"B01_getAddrInfoByCustomerAddrId"}'},success:function(a){if(a=a||{},a.success){var e=a.customerAddress;s.html('<span class="c-label">收货地址：</span><div class="c-cont"><p class="c-txt">'+e.address+"；<br>电话："+e.mobile+"</p></div>")}}})},payWaySelect:function(){var a=this,s=[],e="",c=$("#payWayName").attr("data-payWayId");$.ajax({type:"POST",url:config.serviceUrl,data:{param:"{"+a.tokens+',"serviceId":"B01_getPayWayByCustomerPayWay","commonParam":'+a.commonParam+',"companyId":"'+_vParams.companyId+'","customerId":"'+_vParams.customerId+'","cPayWayId":"'+c+'"}'},success:function(a){a=a||{},a.success&&(e=a.payWapName)}}),$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"serviceId": "B01_findCompanyPayWayList","commonParam": '+a.commonParam+","+a.tokens+',"companyId":"'+_vParams.companyId+'","payWayType":"1"}'},success:function(c){if(c=c||{},c.success){for(var i=c.payWayList,n=i.length,t=0;n>t;t++)s.push(i[t].payWayName);a.initSelect3("#checkoutType",s,e)}}})},submitFn:function(){var a=[],s=$("#dealType").select3("value"),e=$("#logisticsType").select3("value"),c=$("#checkoutType").select3("value");a[0]={conditionName:s,logisticsType:e,payWayName:c},$.ajax({type:"POST",url:config.serviceUrl,data:{param:'{"poAnswerOrderInfo":'+JSON.stringify(a)+',"serviceId":"B03_poAnswerToSalesOrder"}'},success:function(){fnTip.success(2e3),setTimeout(window.location.reload(),2e3)}})}};